databaseChangeLog:
  - changeSet:
      id: initial-schema
      author: mansengstedt
      objectQuotingStrategy: LEGACY
      changes:
        - createTable:
            tableName: llm_prompt
            columns:
              - column:
                  name: prompt_id
                  type: VARCHAR(36)
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: prompt
                  type: CLOB
                  constraints:
                    nullable: false
              - column:
                  name: chat_id
                  type: VARCHAR(128)
                  constraints:
                    nullable: true
              - column:
                  name: prompted_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false

        - createIndex:
            tableName: llm_prompt
            indexName: idx_llm_prompt_chatId
            columns:
              - column:
                  name: chat_id
        - createIndex:
            tableName: llm_prompt
            indexName: idx_llm_prompt_prompted_at
            columns:
              - column:
                  name: prompted_at

        - createTable:
            tableName: llm_completion
            columns:
              - column:
                  name: prompt_id
                  type: VARCHAR(36)
                  constraints:
                    primaryKey: true
                    nullable: false
                    foreignKeyName: llm_completion_llm_prompt_fk
                    references: llm_prompt(prompt_id)
              - column:
                  name: completion_id
                  type: VARCHAR(36)
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: completion
                  type: CLOB
                  constraints:
                    nullable: false
              - column:
                  name: llm
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: llm_provider
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
              - column:
                  name: token_usage
                  type: VARCHAR(128)
                  constraints:
                    nullable: false
              - column:
                  name: execution_time_ms
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: completed_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
        - createIndex:
            tableName: llm_completion
            indexName: idx_llm_completion_completed_at
            columns:
              - column:
                  name: completed_at